---
import { useTranslations } from '../i18n/utils';
import type { Lang } from '../i18n/ui';

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const VERSION = 'v0.5.1-alpha';
const VERSION_SHORT = '0.5.1-alpha';
const BASE_URL = `https://github.com/olympus-btc/ambrosia/releases/download/${VERSION}`;
const RELEASES_URL = 'https://github.com/olympus-btc/ambrosia/releases';
const REPO_URL = 'https://github.com/olympus-btc/ambrosia';

const platforms = [
  {
    id: 'linux',
    nameKey: 'dl.linux',
    icon: 'linux',
    arches: [
      {
        labelKey: 'dl.linux.x64',
        files: [
          { ext: '.deb', label: 'Ubuntu, Debian, Linux Mint', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-x64.deb` },
          { ext: '.rpm', label: 'Fedora, RHEL, openSUSE', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-x64.rpm` },
          { ext: '.tar.gz', label: 'Universal Linux', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-x64.tar.gz` },
        ],
      },
      {
        labelKey: 'dl.linux.arm',
        files: [
          { ext: '.deb', label: 'Ubuntu, Debian, Raspberry Pi OS', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-arm64.deb` },
          { ext: '.rpm', label: 'Fedora ARM', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-arm64.rpm` },
          { ext: '.tar.gz', label: 'Universal ARM', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-arm64.tar.gz` },
        ],
      },
    ],
    verifyCmd: `sha256sum AmbrosiaPoS-${VERSION_SHORT}-x64.deb`,
  },
  {
    id: 'windows',
    nameKey: 'dl.windows',
    icon: 'windows',
    arches: [
      {
        labelKey: 'dl.windows.x64',
        files: [
          { ext: '.exe', label: 'Windows 10/11 Installer', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-x64.exe` },
        ],
      },
      {
        labelKey: 'dl.windows.arm',
        files: [
          { ext: '.exe', label: 'Windows 10/11 ARM Installer', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-arm64.exe` },
        ],
      },
    ],
    verifyCmd: `Get-FileHash AmbrosiaPoS-${VERSION_SHORT}-x64.exe -Algorithm SHA256`,
  },
  {
    id: 'macos',
    nameKey: 'dl.macos',
    icon: 'macos',
    arches: [
      {
        labelKey: 'dl.macos.x64',
        files: [
          { ext: '.dmg', label: 'macOS 11+ Installer', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-x64.dmg` },
        ],
      },
      {
        labelKey: 'dl.macos.arm',
        files: [
          { ext: '.dmg', label: 'macOS 11+ Installer', url: `${BASE_URL}/AmbrosiaPoS-${VERSION_SHORT}-arm64.dmg` },
        ],
      },
    ],
    verifyCmd: `shasum -a 256 AmbrosiaPoS-${VERSION_SHORT}-arm64.dmg`,
  },
];
---

<section id="download" class="py-20 md:py-28 px-4 md:px-8">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-10 md:mb-14">
      <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-th mb-4">
        {t('dl.header')}
      </h2>
      <p class="text-base md:text-lg text-tsec max-w-2xl mx-auto mb-6">
        {t('dl.subheader')}
      </p>
      <div class="inline-flex items-center gap-3 flex-wrap justify-center text-sm">
        <span class="px-3 py-1.5 bg-green-400/10 border border-green-400/20 rounded-full text-green-400 font-mono font-medium">
          {t('dl.version')}: {VERSION}
        </span>
        <a href={RELEASES_URL} target="_blank" rel="noopener noreferrer" class="dl-link text-tsec hover:text-green-400 transition-colors">
          {t('dl.changelog')}
        </a>
        <a href={REPO_URL} target="_blank" rel="noopener noreferrer" class="dl-link text-tsec hover:text-green-400 transition-colors">
          {t('dl.source')}
        </a>
      </div>
    </div>

    <!-- Platform Cards -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8 mb-16">
      {platforms.map((platform) => (
        <div class="p-6 md:p-8 bg-surface-card border border-b-subtle rounded-2xl hover:border-green-400/20 transition-colors">
          <!-- Platform header -->
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 flex items-center justify-center rounded-xl bg-green-400/10 text-green-400">
              {platform.icon === 'linux' && (
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12.504 0c-.155 0-.311.002-.465.007C7.668.136 4.514 3.373 4.008 6.82c-.15 1.02-.145 1.96.066 2.836.358 1.484 1.178 2.816 2.12 3.94.236.282.478.558.706.84.727.898 1.282 1.776 1.467 2.87.055.324.03.674-.1 1.1-.263.852-.737 1.536-1.3 2.16l-.073.08c-.18.205-.363.408-.538.625-.7.87-1.261 1.868-1.261 3.075a.5.5 0 0 0 1 0c0-.88.391-1.618.98-2.35.16-.2.332-.39.509-.588l.08-.09c.6-.662 1.143-1.435 1.452-2.43.17-.547.225-1.066.143-1.548-.222-1.303-.893-2.34-1.693-3.328-.218-.27-.448-.53-.673-.798-.904-1.077-1.648-2.296-1.968-3.624-.171-.71-.19-1.49-.06-2.37.436-2.97 3.177-5.768 7.127-5.882.134-.004.27-.006.404-.006 4.178 0 7.39 3.037 7.869 6.24.15 1.002.102 2.024-.156 3.027-.358 1.39-1.152 2.647-2.08 3.75a13.08 13.08 0 0 0-.73.916c-.776 1.048-1.368 2.097-1.56 3.358-.066.438-.033.891.1 1.35.295.997.854 1.82 1.47 2.54.163.19.33.375.494.562.554.633.94 1.28.94 2.128a.5.5 0 0 0 1 0c0-1.14-.54-2.04-1.176-2.768-.17-.195-.347-.385-.515-.58-.578-.678-1.07-1.406-1.322-2.26-.095-.32-.12-.634-.072-.95.157-1.03.664-1.934 1.37-2.888a14 14 0 0 1 .793-1.005c.988-1.178 1.85-2.554 2.24-4.065.295-1.14.345-2.31.175-3.45C20.07 3.173 16.582 0 12.504 0z"/>
                </svg>
              )}
              {platform.icon === 'windows' && (
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M0 3.449L9.75 2.1v9.451H0m10.949-9.602L24 0v11.4H10.949M0 12.6h9.75v9.451L0 20.699M10.949 12.6H24V24l-12.9-1.801"/>
                </svg>
              )}
              {platform.icon === 'macos' && (
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                </svg>
              )}
            </div>
            <h3 class="text-xl font-bold text-th">{t(platform.nameKey as any)}</h3>
          </div>

          <!-- Architectures -->
          {platform.arches.map((arch, archIdx) => (
            <div class:list={["mb-5", archIdx > 0 && "mt-6 pt-5 border-t border-b-subtle"]}>
              <h4 class="text-sm font-semibold text-tb mb-3">{t(arch.labelKey as any)}</h4>
              <div class="flex flex-col gap-2">
                {arch.files.map((file) => (
                  <a href={file.url} class="dl-item group flex items-center gap-3 p-3 rounded-lg bg-surface-card border border-b-subtle hover:bg-green-400/5 hover:border-green-400/20 transition-all">
                    <svg class="w-4 h-4 text-green-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7 10 12 15 17 10"/>
                      <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <div class="flex-1 min-w-0">
                      <span class="text-sm font-mono font-medium text-green-400">{file.ext}</span>
                      <span class="text-xs text-tm ml-2">{file.label}</span>
                    </div>
                    <svg class="w-4 h-4 text-td group-hover:text-green-400 group-hover:translate-x-0.5 transition-all shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
                    </svg>
                  </a>
                ))}
              </div>
            </div>
          ))}

          <!-- Verify command -->
          <div class="mt-4 pt-4 border-t border-b-subtle">
            <p class="text-xs text-tm mb-1.5">{t('dl.checksums.verify')}:</p>
            <code class="block text-xs font-mono text-tsec bg-code-bg px-3 py-2 rounded-lg overflow-x-auto">
              {platform.verifyCmd}
            </code>
          </div>
        </div>
      ))}
    </div>

    <!-- System Requirements -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-16">
      <!-- Requirements -->
      <div class="p-6 md:p-8 bg-surface-card border border-b-subtle rounded-2xl">
        <h3 class="text-xl md:text-2xl font-bold text-th mb-6">{t('dl.reqs.title')}</h3>

        <div class="mb-6">
          <h4 class="text-sm font-semibold text-green-400 mb-3 uppercase tracking-wider">{t('dl.reqs.minimum')}</h4>
          <div class="flex flex-col gap-3">
            <div class="text-sm">
              <span class="text-tsec">{t('dl.reqs.ram')}</span>
              <span class="text-ts ml-2">{t('dl.reqs.ram.min')}</span>
            </div>
            <div class="text-sm">
              <span class="text-tsec">{t('dl.reqs.storage')}</span>
              <span class="text-ts ml-2">{t('dl.reqs.storage.min')}</span>
            </div>
            <div class="text-sm">
              <span class="text-tsec">{t('dl.reqs.cpu')}</span>
              <span class="text-ts ml-2">{t('dl.reqs.cpu.val')}</span>
            </div>
            <div class="text-sm">
              <span class="text-tsec block mb-0.5">{t('dl.reqs.network')}</span>
              <span class="text-ts">{t('dl.reqs.network.val')}</span>
            </div>
          </div>
        </div>

        <div>
          <h4 class="text-sm font-semibold text-green-400 mb-3 uppercase tracking-wider">{t('dl.reqs.recommended')}</h4>
          <div class="flex flex-col gap-3">
            <div class="text-sm">
              <span class="text-tsec">{t('dl.reqs.ram')}</span>
              <span class="text-ts ml-2">{t('dl.reqs.ram.rec')}</span>
            </div>
            <div class="text-sm">
              <span class="text-tsec">{t('dl.reqs.storage')}</span>
              <span class="text-ts ml-2">{t('dl.reqs.storage.rec')}</span>
            </div>
            <div class="text-sm">
              <span class="text-tsec block mb-0.5">{t('dl.reqs.hardware')}</span>
              <span class="text-ts">{t('dl.reqs.hardware.val')}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- OS + Install + Help -->
      <div class="flex flex-col gap-6">
        <!-- Supported OS -->
        <div class="p-6 md:p-8 bg-surface-card border border-b-subtle rounded-2xl">
          <h3 class="text-lg font-bold text-th mb-4">{t('dl.reqs.os')}</h3>
          <div class="flex flex-col gap-4">
            <div>
              <span class="text-green-400 text-sm font-semibold block mb-1">Linux</span>
              <span class="text-sm text-tsec">{t('dl.reqs.os.linux')}</span>
            </div>
            <div>
              <span class="text-green-400 text-sm font-semibold block mb-1">Windows</span>
              <span class="text-sm text-tsec">{t('dl.reqs.os.windows')}</span>
            </div>
            <div>
              <span class="text-green-400 text-sm font-semibold block mb-1">macOS</span>
              <span class="text-sm text-tsec">{t('dl.reqs.os.macos')}</span>
            </div>
          </div>
        </div>

        <!-- Need Help -->
        <div class="p-6 md:p-8 bg-surface-card border border-b-subtle rounded-2xl">
          <h3 class="text-lg font-bold text-th mb-4">{t('dl.help.title')}</h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
            <a href="https://docs.ambrosiapos.com/" target="_blank" rel="noopener noreferrer" class="dl-item group flex items-center gap-2 p-3 rounded-lg bg-surface-card border border-b-subtle hover:bg-green-400/5 hover:border-green-400/20 transition-all">
              <svg class="w-4 h-4 text-green-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
              </svg>
              <span class="text-sm text-tb">{t('dl.help.docs')}</span>
            </a>
            <a href="https://t.me/ambrosiapos" target="_blank" rel="noopener noreferrer" class="dl-item group flex items-center gap-2 p-3 rounded-lg bg-surface-card border border-b-subtle hover:bg-green-400/5 hover:border-green-400/20 transition-all">
              <svg class="w-4 h-4 text-green-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
              <span class="text-sm text-tb">{t('dl.help.community')}</span>
            </a>
            <a href="https://github.com/olympus-btc/ambrosia/issues" target="_blank" rel="noopener noreferrer" class="dl-item group flex items-center gap-2 p-3 rounded-lg bg-surface-card border border-b-subtle hover:bg-green-400/5 hover:border-green-400/20 transition-all">
              <svg class="w-4 h-4 text-green-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              <span class="text-sm text-tb">{t('dl.help.issues')}</span>
            </a>
            <a href="mailto:support@ambrosiapos.com" class="dl-item group flex items-center gap-2 p-3 rounded-lg bg-surface-card border border-b-subtle hover:bg-green-400/5 hover:border-green-400/20 transition-all">
              <svg class="w-4 h-4 text-green-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>
              </svg>
              <span class="text-sm text-tb">{t('dl.help.contact')}</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Verify section -->
    <div class="p-6 md:p-8 bg-green-400/5 border border-green-400/10 rounded-2xl text-center">
      <div class="flex items-center justify-center gap-3 mb-4">
        <svg class="w-6 h-6 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <h3 class="text-xl font-bold text-th">{t('dl.verify.title')}</h3>
      </div>
      <p class="text-sm text-tsec mb-4 max-w-xl mx-auto">{t('dl.verify.desc')}</p>
      <p class="text-xs text-tm">{t('dl.verify.match')}</p>
    </div>
  </div>
</section>
