---
import LanguagePicker from './LanguagePicker.astro';
import ThemeToggle from './ThemeToggle.astro';
import { useTranslations } from '../i18n/utils';
import type { Lang } from '../i18n/ui';
interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const navItems = [
  { key: 'nav.features', href: '#features' },
  { key: 'nav.why', href: '#why-ambrosia' },
  { key: 'nav.how', href: '#how-it-works' },
  { key: 'nav.opensource', href: '#open-source' },
  { key: 'nav.download', href: '#download' },
] as const;
---

<header class="fixed top-0 left-0 right-0 flex justify-between items-center px-4 py-4 md:px-8 z-50 bg-surface-overlay backdrop-blur-xl border-b border-b-subtle" id="header">
  <a href={`/${lang}/`} class="flex items-center gap-2 no-underline text-th hover:text-green-400 transition-colors">
    <img src="/logo.png" alt="Ambrosia Logo" class="h-8" />
  </a>

  <nav class="hidden lg:flex gap-1">
    {navItems.map(({ key, href }) => (
      <a href={href} {...(href === '#download' ? { 'data-download': 'nav-download' } : {})} class="px-4 py-2 text-sm font-medium text-tsec no-underline rounded-md hover:text-th hover:bg-surface-interactive transition-all">
        {t(key as any)}
      </a>
    ))}
  </nav>

  <div class="flex items-center gap-3">
    <ThemeToggle />
    <LanguagePicker lang={lang} />
    <button
      class="flex lg:hidden items-center justify-center w-10 h-10 bg-surface-interactive border border-b-default rounded-lg text-th cursor-pointer hover:bg-surface-interactive-hover transition-all"
      aria-label="Menu"
      id="mobile-menu-btn"
    >
      <svg class="w-5 h-5 menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
      <svg class="w-5 h-5 close-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <nav class="hidden absolute top-full left-0 right-0 flex-col p-4 bg-surface-overlay-heavy backdrop-blur-xl border-b border-b-subtle lg:hidden!" id="mobile-nav">
    {navItems.map(({ key, href }) => (
      <a href={href} {...(href === '#download' ? { 'data-download': 'nav-download-mobile' } : {})} class="px-4 py-3.5 text-base font-medium text-tsec no-underline rounded-lg hover:text-th hover:bg-surface-interactive transition-all">
        {t(key as any)}
      </a>
    ))}
  </nav>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const nav = document.getElementById('mobile-nav');
  const menuIcon = btn?.querySelector('.menu-icon');
  const closeIcon = btn?.querySelector('.close-icon');

  btn?.addEventListener('click', () => {
    const isOpen = nav?.classList.contains('flex');
    if (isOpen) {
      nav?.classList.remove('flex');
      nav?.classList.add('hidden');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    } else {
      nav?.classList.remove('hidden');
      nav?.classList.add('flex');
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');
    }
  });

  nav?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      nav?.classList.remove('flex');
      nav?.classList.add('hidden');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    });
  });
</script>
